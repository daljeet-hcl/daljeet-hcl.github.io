<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="theme-color" content="#000000">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

  <!-- Latest compiled JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<style>
  input#query {
    width: 25%
  }
</style>

<body>

  <h4>Search Guru Granth Sahib</h4>

  <div id="title"> </div>
  <div class="form-group" id="content">
      <form action="shabadSearch.html">
      <a href="/index.html"> Page </a><label for="search">query:</label>    
    <input type="text" class="form-control" id="query" name="query">
    <br>
    <button type="submit" class="btn">First Letter </button>
    <button type="submit" class="btn">Whole Word</button>
    </form>
    <form id="demo"></form>
  </div>

  <script>
    var resonse; //response from server
    var query; //shabad query
    $(window).on("load", function () {
      query = getURLParameter("query");
      if (query != null) {
        $("#query").val(query);
        loadXMLDoc(query);
      } else {
        var word = getURLParameter("fullword");
        if (word != null) {
         
        }
      }
    });

    function getURLParameter(sParam) {
      var sPageURL = window.location.search.substring(1);
      var sURLVariables = sPageURL.split('&');
      for (var i = 0; i < sURLVariables.length; i++) {
        var sParameterName = sURLVariables[i].split('=');
        if (sParameterName[0] == sParam) {
          return sParameterName[1];
        }
      }
    }

    function loadXMLDoc(query) {
      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
          response = JSON.parse(this.responseText);
          console.log(response.count);
          console.log(response.shabads);
          $("#demo").html("<p/>");
          $("#demo").html($("#demo").html() + "Result Count = " + response.count);
          $("#demo").html($("#demo").html() + "<br/>");

          response.shabads.map((x, index) => {
            console.log(x);
            $("#demo").html($("#demo").html() + "<br/> <b> <a href='index.html?shabad=" +x.shabad.shabadid +"#"+ x.shabad.id+"'> " + x.shabad.transliteration.devanagari.text + '</a> </b>');
            $("#demo").html($("#demo").html() + "<br/><br/>" + x.shabad.source.english + 
            "   <b> <a href='index.html?page="+x.shabad.pageno+"#"+x.shabad.id +"'>" + x.shabad.pageno + '</a><b>   ' + x.shabad.writer.english + "<br/>");
          });
        }
      };

      
      xhttp.open("GET", "https://api.gurbaninow.com/v2/search/" + query, true);
      xhttp.send();
    }

     function loadXMLDoc2() {
      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
          response = JSON.parse(this.responseText);
          console.log(response.count);
          console.log(response.shabads);
          $("#demo").html("<p/>");
          $("#demo").html($("#demo").html() + "Result Count = " + response.count);
          $("#demo").html($("#demo").html() + "<br/>");

          response.shabads.map((x, index) => {
            console.log(x);
            $("#demo").html($("#demo").html() + "<br/> <b> <a href='index.html?shabad=" +x.shabad.shabadid +"'> " + x.shabad.transliteration.devanagari.text + '</a> </b>');
            $("#demo").html($("#demo").html() + "<br/><br/>" + x.shabad.source.english + 
            "   <b> <a href='index.html?page="+x.shabad.pageno+"'>" + x.shabad.pageno + '</a><b>   ' + x.shabad.writer.english + "<br/>");
          });
        }
      };

      
      xhttp.open("GET", "https://api.gurbaninow.com/v2/search/" + document.getElementById("search").value+ "/?searchtype=3", true);
      xhttp.send();
    }
  </script>

</body>

</html>